<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="rpg-entity">
  <template>
		<style>
			:host {
			  position: absolute;
			  cursor: pointer;
			  transition: left 0.5s linear,top 0.5s linear;
		    transform: translateZ(0);
			}
			:host .rpg-entity:hover img {
			  transform: scale(1.2);
			}
			:host .rpg-entity:hover span {
			  opacity: 1;
			}
			:host .rpg-entity {
			  width: 32px;
			  height: 32px;
			}
			:host .rpg-entity span {
			  opacity: 0.1;
			  transition: opacity 0.1s linear;
			  position: relative;
		    margin-left: -14px;
  			margin-top: 14px;
			}
			:host .rpg-entity img {
			  vertical-align: top;
			  transition: transform 0.1s linear;
			  cursor: pointer;
			}
			:host .rpg-entity .rpg-name {
			  z-index: 10;
			  font-weight: bolder;
			  font-size: 10px;
			  display: inline-block;
			  width: 60px;
			  border: 1px solid;
			  background-color: white;
			  border-radius: 4px;
			  top: -40px;
			  left: 0;
			  position: absolute;
			}
			:host .rpg-entity .rpg-life {
			  z-index: 10;
			  border: 1px solid;
			  display: inline-block;
			  width: 60px;
			  height: 8px;
			  border-radius: 4px;
			  overflow: hidden;
			  position: absolute;
			  background-color: white;
			  left: 0;
			  bottom: -15px;
			}
			:host .rpg-entity .rpg-life i {
			  background-color: lime;
			  width: 100%;
			  height: 8px;
			  display: inline-block;
			  margin: 0;
			  padding: 0;
			  position: absolute;
			  top: 0;
			  left: 0;
			  transition: width 1s;
			}
			:host .rpg-entity.collide {
			  animation-name: collide;
			  animation-duration: 0.1s;
			  animation-iteration-count: 2;
			}

			@keyframes collide {
			  0% {
			    margin-left: 5px;
			  }
			  50% {
			    margin-left: -5px;
			  }
			  100% {
			    margin-left: 0;
			  }
			}

		</style>
	  <div class="rpg-entity" data-x="{{position.x}}" data-y="{{position.y}}">
	  	<span class="rpg-life"><i style="width:{{life}%;"></i></span>
	  	<span class="rpg-name">{{name}}</span>
	  	<img src="{{avatar}}" width="32px" height="32px"/>
	  	<content></content>
	  </div>
	</template>
  <script>
    Polymer({
    	name: '',
    	life: 100,
    	avatar: '',
    	position: {x:0,y:0},
    	collide: function(){
  		  this.classList.add('collide');
		    setTimeout(function() {
		      this.classList.remove('collide');
		    }.bind(this), 1000);
    	},
    	transpose: function(location){
    		this.style.top = location.top + 15 + 'px',
    		this.style.left = location.left + 15 + 'px'
    	},
    	set: function(data){
    		data.name && (this.name = data.name);
    		data.life && (this.life = data.life);
    		data.avatar && (this.avatar = data.avatar);
    		data.position && (this.position = data.position);

    		this.dataset.x = this.position.x;
    		this.dataset.y = this.position.y;
    	}
    });
  </script>
</polymer-element>